Install prerequisites:

 sudo perl -MCPAN -e 'install Cache::Memcached'
 sudo perl -MCPAN -e 'install MogileFS::Client'

Create accounts and database for warehouse system:

 create database warehouse;
 grant all privileges on warehouse.* to whserver@'%';
 set password for whserver@'%' = old_password('YOURPASSWORDHERE');

Give the warehouse user permission to use the mapreduce database:

 grant all privileges on mapreduce.* to whserver@'%';

Extract current version:

 cd /tmp
 svn co http://dev.freelogy.org/svn/polony/polony-tools/trunk/warehouse
 cd ./warehouse

Create /etc/warehouse/warehouse-server.conf to suit:

 mkdir -p /etc/warehouse
 cp -i server/warehouse-server.conf.sample /etc/warehouse/warehouse-server.conf
 vi /etc/warehouse/warehouse-server.conf

Create database tables:

 su -u www-data -- sh -c 'cd server && perl setup.pl'

Create /etc/warehouse/warehouse-client.conf to suit -- see
../client/INSTALL for details.

Test and install the Perl API, server, and sample client programs:

 (
 set -ex
 perl Makefile.PL
 make
 make test
 make install
 )

Create supervised service:

 (
 set -ex
 sudo apt-get install runit
 
 d=/var/service/warehoused
 sudo mkdir -p $d/log/main
 sudo chmod +t $d
 (echo '#!/bin/sh'; echo 'exec svlogd -tt main') \
   | sudo bash -c "cat >$d/log/run"
 (echo '#!/bin/sh'; echo 'exec warehoused 2>&1') \
   | sudo bash -c "cat >$d/run"
 sudo chmod +x $d/run $d/log/run
 )
