#!/usr/bin/perl

# mrtaskmanager: run a map or reduce function on one input.

use strict;
use MogileFS::Client;

$ENV{PATH} .= ":$ENV{MR_REVISION_INSTALLDIR}/bin";
$ENV{PATH} .= ":$ENV{MR_REVISION_INSTALLDIR}/src/mapreduce";
$ENV{PERLLIB} .= "$ENV{MR_REVISION_INSTALLDIR}/src/warehouse/lib:$ENV{MR_REVISION_INSTALLDIR}/src/mapreduce";

foreach (split ("\n", $ENV{MR_KNOBS}))
{
  my ($k, $v) = split ("=", $_, 2);
  $ENV{"KNOB_$k"} = $v;
}

open STDOUT, ">/dev/null";
exec "mr-$ENV{MR_FUNCTION}";
die "mr-$ENV{MR_FUNCTION}: $!";
